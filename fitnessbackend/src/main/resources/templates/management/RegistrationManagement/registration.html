<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
    <link href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css" rel="stylesheet">
    <base href="/">
</head>
<th:block th:insert="/fragments/admin_fragment/header"></th:block>
<!-- Mirrored from educhamp.themetrades.com/demo/admin/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 22 Feb 2019 13:08:15 GMT -->
<th:block th:insert="/fragments/admin_fragment/head"></th:block>
<body class="ttr-opened-sidebar ttr-pinned-sidebar">
<th:block th:insert="/fragments/admin_fragment/sidebar_fragment"></th:block>
<!-- Left sidebar menu end -->

<!--Main container start -->
<main class="ttr-wrapper">
    <div class="container-fluid">
        <div class="db-breadcrumb">
            <h4 class="breadcrumb-title">Registration</h4>
            <ul class="db-breadcrumb-list">
                <li><a href="#"><i class="fa fa-home"></i>Home</a></li>
                <li>Studio</li>
            </ul>
        </div>

        <div class="row">
            <!-- Your Profile Views Chart -->
            <div class="col-lg-12 m-b30">
                <div class="widget-box">

                    <div class="wc-title row">
                        <h4>Registration List</h4>
                    </div>
                    <form class="col-12 row" id="searchAndFilterRegistration" th:action="@{/registration/management/registrations}" method="get">

                        <div class="form-group row col-4 ">

                            <div class="col-sm-8">
                                <select class="form-control" th:name="city" onchange="submitFormDashboard()">
                                    <option  value="">All City</option>
                                    <th:block th:each="city : ${listCity}">
                                        <option th:value="${city.id}" th:text="${city.name}"
                                                th:selected="${currentCity.equals(''+city.id)}"></option>
                                    </th:block>
                                </select>

                            </div>
                        </div>
                        <div class="form-group row col-4 ">

                            <div class="col-sm-8">
                                <select class="form-control" th:name="studio" onchange="submitFormDashboard()">
                                    <option  value="">All Studio</option>
                                    <th:block th:each="studio : ${studioDTOList}">
                                        <option th:value="${studio.id}" th:text="${studio.name}"
                                                th:selected="${currentStudio.equals(''+studio.name)}"></option>
                                    </th:block>
                                </select>

                            </div>
                        </div>
                        <div class="form-group row col-4 ml-0">

                            <div class="col-sm-9">
                                <select class="form-control" th:name="studioStatus" onchange="submitFormDashboard()">
                                    <option th:selected="${status.equals('')}" value="" >All Status</option>
                                    <option th:selected="${status.equals(''+0)}" value="0" >Pending</option>
                                    <option th:selected="${status.equals(''+1)}" value="1" >Verified</option>
                                    <option th:selected="${status.equals(''+2)}" value="2" >Cancel</option>
                                    <option th:selected="${status.equals(''+3)}" value="3" >In Progress</option>
                                    <option th:selected="${status.equals(''+4)}" value="4" >Expired</option>
                                </select>
                            </div>
                        </div>

                        <div class="search-box col-lg-3 col-3 col-md-1 col-sm-1 d-inline">
                            <input type="text"  class="form-control" placeholder="Search&hellip;" th:name="keyword" th:value="${keyword}">
                        </div>
                        <div class="search-box col-lg-2 col-1 col-md-1 col-sm-1">
                            <input class="btn pl-3 pr-3" type="submit" value="Search">
                        </div>
                    </form>
                    <div class="container-fluid row ml-5 mt-5">
                        <div class="col-lg-12 col-12 col-md-12 col-sm-12 row">

                        </div>
                    </div>

                    <div class="widget-inner">

                        <table class="table table-hover table-bordered sortable" id="studio_table">
                            <thead>
                            <tr>
                                <th>City</th>
                                <th>Service Name</th>
                                <th>Studio</th>
                                <th>Service Type</th>
                                <th>Service Price</th>
                                <th>Customer Information</th>
                                <th>Customer Phone</th>
                                <th>Started Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>

                            <tr th:each="registration: ${registrations}">
                                <td th:text="${registration.servicesCityCityName}"></td>
<!--                                <td th:text="${registration.servicesStudioName}"></td>-->
                                <td th:text="${registration.servicesName}"></td>
                                <span th:if="${registration.servicesStudioName != null}">
                        <td th:text="${registration.servicesStudioName}" ></td>
                    </span>
                                <span th:if="${registration.servicesStudioName == null}">
                        <td>All studio</td>
                    </span>
                                <td th:text="${registration.servicesType}"></td>
                                <td th:text="${registration.servicesPrice}"></td>
                                <td th:text="${registration.traineeEmail +' '+ registration.traineeUserFirstName+' '+ registration.traineeUserLastName}" ></td>
                                <td th:text="${registration.traineeUserPhone}"></td>
                                <td th:text="${registration.startDate}"></td>
                                <span th:if="${registration.status ==0}">
                        <td>Pending</td>
                    </span>
                                <span th:if="${registration.status == 1}">
                    <td>Verified</td>
                    </span>
                                <span th:if="${registration.status == 2}">
                    <td>Cancel</td>
                    </span>
                                <span th:if="${registration.status == 3}">
                    <td>In progress</td>
                    </span>
                                <span th:if="${registration.status == 4}">
                    <td>Expired</td>
                    </span>
                                <td>
                                    <a class="edit" data-toggle="tooltip"
                                       th:href="@{/registration/management/registrations/{id} (id=${registration.id})}"
                                       title="Edit"><i class="material-icons fa" style="font-size: 25px" data-hover-only="Edit">&#xf044;</i></a>
                                    <a class="active" data-toggle="tooltip" onclick="return confirm('Are you sure you want to verify this Registration?')"
                                       th:href="@{/registration/management/statusregistrations/{id}/{status} (status=${1}, id=${registration.id} )}"
                                       th:if="${registration.status == 0}"><i
                                            class="material-icons fa fa-check-circle" style="font-size: 25px" data-hover-only="Verify"></i></a>
                                    <a class="active" data-toggle="tooltip" onclick="return confirm('Are you sure you want to approve this Registration?')"
                                       th:href="@{/registration/management/statusregistrations/{id}/{status} (status=${3}, id=${registration.id} )}"
                                       th:if="${registration.status == 1}"><i
                                            class="material-icons fa fa-arrow-circle-up" style="font-size: 25px" data-hover-only="Approve"></i></a>
                                    <a class="active" data-toggle="tooltip" onclick="return confirm('Are you sure you want to cancel this Registration?')"
                                       th:href="@{/registration/management/statusregistrations/{id}/{status} (status=${2}, id=${registration.id} )}"
                                       th:if="${registration.status != 2 && registration.status!=4}"><i
                                            class="material-icons fa fa-arrow-circle-down" style="font-size: 25px" data-hover-only="Cancel"></i></a>
                                </td>

                            </tr>
                            </tbody>
                        </table>
<!--                        <div id="pagination"></div>-->
                        <div class="pagination-cover">
                            <ul class="pagination">
                                <li class="pagination-item item-prev"
                                    th:classappend="${currentPage -1 == 0} ? 'disabled':''" th:if="${currentPage -1 > 0}">
                                    <a th:href="@{/registration/management/registrations(pageNumber=${currentPage - 1},keyword=${currentKeyword},city=${currentCity},status=${currentStatus})}">
                                        <i aria-hidden="true" class="fa fa-angle-left"></i>
                                    </a>
                                </li>
                                <li class="pagination-item " th:classappend="${currentPage == i}? 'active' :'' "
                                    th:each="i: ${#numbers.sequence(1,totalPage)}">
                                    <a th:href="@{/registration/management/registrations(pageNumber=${i},city=${currentCity},keyword=${currentKeyword},status=${currentStatus})}"
                                       th:text="${i}"></a>
                                </li>
                                <li class="pagination-item item-next"
                                    th:classappend="${currentPage == totalPage}  ? 'disabled':''"
                                    th:if="${currentPage < totalPage}">
                                    <a th:href="@{/registration/management/registrations(pageNumber=${currentPage + 1},city=${currentCity},keyword=${currentKeyword},status=${currentStatus})}">
                                        <i aria-hidden="true" class="fa fa-angle-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div>
</main>
<div class="ttr-overlay"></div>

<!-- External JavaScripts -->
<th:block th:insert="/fragments/admin_fragment/script"></th:block>
</body>
<script src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        $('#studio_table').DataTable({
            // dom: 'rtip',
            columnDefs: [{
                visible: false,
                searchable: false
            }],
            pagingType: 'full_numbers',
            bLengthChange: false,
            "bInfo": false,
            entries: false,
            searching: false,
            paging: false,
            pageLength: 5,
        });
    });
</script>

<script type="text/javascript">
    const cities = $("#city");
    const studios = $("studio");
    function renderStudio(data) {
        for (const x of data) {
            cities.append(` <option value="${x.Name}">${x.Name}</option>`);
        }
        cities.onchange = function () {
            studios.length = 1;
            if (this.value != "") {
                const result = data.filter(n => n.Name === this.value);
                studios.html("");
                for (const k of result[0].Districts) {
                    studios.append(` <option value="${k.Name}">${k.Name}</option>`);
                }
            }
        };

    }
    function submitFormDashboard() {
        document.getElementById("searchAndFilterRegistration").submit();
    }
</script>
</html>
